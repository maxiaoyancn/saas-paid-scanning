# 收费软件检测系统 - 快速开始指南
## Quick Start Guide

---

## 🚀 快速开始

### 环境要求
- **Golang**: 1.21+
- **Node.js**: 18+
- **Docker**: 20.10+
- **Docker Compose**: 2.0+
- **PostgreSQL**: 15+
- **Redis**: 7+

---

## 📦 项目初始化

### 1. 克隆项目
```bash
git clone https://github.com/your-org/saas-scanning-system.git
cd saas-scanning-system
```

### 2. 环境配置
```bash
# 复制环境变量文件
cp .env.example .env

# 编辑环境变量
vim .env
```

### 3. 启动开发环境
```bash
# 启动基础服务 (PostgreSQL, Redis, RabbitMQ)
docker-compose up -d postgres redis rabbitmq

# 等待服务启动完成
sleep 10

# 运行数据库迁移
make migrate

# 启动后端服务
make run-backend

# 启动前端服务 (新终端)
make run-frontend
```

---

## 🛠️ 开发环境搭建

### 后端开发环境

#### 1. 安装Go依赖
```bash
cd backend
go mod download
go mod tidy
```

#### 2. 配置环境变量
```bash
# .env
DATABASE_URL=postgres://postgres:password@localhost:5432/saas_scanning?sslmode=disable
REDIS_URL=redis://localhost:6379
RABBITMQ_URL=amqp://admin:password@localhost:5672/
JWT_SECRET=your-super-secret-key
PORT=8080
GIN_MODE=debug
```

#### 3. 数据库迁移
```bash
# 安装migrate工具
go install -tags 'postgres' github.com/golang-migrate/migrate/v4/cmd/migrate@latest

# 运行迁移
migrate -path ./migrations -database $DATABASE_URL up
```

#### 4. 启动服务
```bash
# 启动认证服务
cd services/auth
go run cmd/main.go

# 启动扫描服务 (新终端)
cd services/scanner
go run cmd/main.go

# 启动风险评估服务 (新终端)
cd services/risk
go run cmd/main.go
```

### 前端开发环境

#### 1. 安装依赖
```bash
cd frontend
npm install
# 或者使用 yarn
yarn install
```

#### 2. 配置环境变量
```bash
# .env.local
VITE_API_BASE_URL=http://localhost:8080/api/v1
VITE_WS_BASE_URL=ws://localhost:8080/ws
VITE_APP_NAME=SaaS扫描系统
```

#### 3. 启动开发服务器
```bash
npm run dev
# 或者
yarn dev
```

### 桌面客户端开发

#### 1. 安装依赖
```bash
cd desktop
npm install
```

#### 2. 启动开发模式
```bash
npm run electron:dev
```

#### 3. 打包应用
```bash
# Windows
npm run build:win

# macOS
npm run build:mac

# Linux
npm run build:linux
```

---

## 🔧 开发工具配置

### VSCode配置
```json
// .vscode/settings.json
{
  "go.useLanguageServer": true,
  "go.lintTool": "golangci-lint",
  "go.formatTool": "goimports",
  "editor.formatOnSave": true,
  "go.testFlags": ["-v", "-race"],
  "typescript.preferences.importModuleSpecifier": "relative"
}
```

### VSCode扩展推荐
```json
// .vscode/extensions.json
{
  "recommendations": [
    "golang.go",
    "ms-vscode.vscode-typescript-next",
    "bradlc.vscode-tailwindcss",
    "ms-vscode.vscode-json",
    "redhat.vscode-yaml",
    "ms-kubernetes-tools.vscode-kubernetes-tools"
  ]
}
```

### Git钩子配置
```bash
# 安装pre-commit
pip install pre-commit

# 安装钩子
pre-commit install
```

```yaml
# .pre-commit-config.yaml
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-json
  
  - repo: https://github.com/golangci/golangci-lint
    rev: v1.54.2
    hooks:
      - id: golangci-lint
  
  - repo: https://github.com/pre-commit/mirrors-eslint
    rev: v8.51.0
    hooks:
      - id: eslint
        files: \.(js|jsx|ts|tsx)$
        additional_dependencies:
          - eslint@8.51.0
          - typescript@5.0.0
```

---

## 📝 API文档

### Swagger文档
访问 `http://localhost:8080/swagger/index.html` 查看API文档

### 生成API文档
```bash
# 安装swag
go install github.com/swaggo/swag/cmd/swag@latest

# 生成文档
cd backend
swag init -g cmd/main.go -o docs
```

### API示例

#### 用户认证
```bash
# 用户注册
curl -X POST http://localhost:8080/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "password123"
  }'

# 用户登录
curl -X POST http://localhost:8080/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "password123"
  }'
```

#### 扫描操作
```bash
# 启动扫描
curl -X POST http://localhost:8080/api/v1/scan/start \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "scan_type": "full",
    "target_paths": ["/Applications", "C:\\Program Files"]
  }'

# 获取扫描结果
curl -X GET http://localhost:8080/api/v1/scan/results/SCAN_ID \
  -H "Authorization: Bearer YOUR_TOKEN"
```

---

## 🧪 测试

### 后端测试
```bash
# 运行所有测试
make test

# 运行特定服务测试
cd services/auth
go test -v ./...

# 运行测试并生成覆盖率报告
go test -v -coverprofile=coverage.out ./...
go tool cover -html=coverage.out -o coverage.html
```

### 前端测试
```bash
cd frontend

# 运行单元测试
npm run test

# 运行E2E测试
npm run test:e2e

# 生成测试覆盖率报告
npm run test:coverage
```

### 集成测试
```bash
# 启动测试环境
docker-compose -f docker-compose.test.yml up -d

# 运行集成测试
make test:integration

# 清理测试环境
docker-compose -f docker-compose.test.yml down
```

---

## 📊 监控和调试

### 健康检查
```bash
# 检查服务状态
curl http://localhost:8080/health

# 检查详细状态
curl http://localhost:8080/health/detailed
```

### 日志查看
```bash
# 查看服务日志
docker-compose logs -f auth-service

# 查看所有服务日志
docker-compose logs -f
```

### 性能监控
- **Prometheus**: http://localhost:9090
- **Grafana**: http://localhost:3000 (admin/admin)
- **Jaeger**: http://localhost:16686

### 数据库管理
```bash
# 连接PostgreSQL
psql -h localhost -p 5432 -U postgres -d saas_scanning

# 连接Redis
redis-cli -h localhost -p 6379

# 查看RabbitMQ管理界面
# http://localhost:15672 (admin/password)
```

---

## 🚢 部署

### 本地部署
```bash
# 构建所有服务
make build

# 启动生产环境
docker-compose -f docker-compose.prod.yml up -d
```

### 云端部署
```bash
# 部署到Kubernetes
kubectl apply -f deployments/k8s/

# 查看部署状态
kubectl get pods -n saas-scanning

# 查看服务状态
kubectl get svc -n saas-scanning
```

---

## 🔍 故障排除

### 常见问题

#### 1. 数据库连接失败
```bash
# 检查PostgreSQL是否启动
docker ps | grep postgres

# 检查数据库连接
psql -h localhost -p 5432 -U postgres -c "SELECT version();"
```

#### 2. Redis连接失败
```bash
# 检查Redis是否启动
docker ps | grep redis

# 测试Redis连接
redis-cli ping
```

#### 3. 服务启动失败
```bash
# 查看服务日志
docker-compose logs service-name

# 检查端口占用
lsof -i :8080
```

#### 4. 前端编译错误
```bash
# 清理缓存
rm -rf node_modules package-lock.json
npm install

# 检查TypeScript错误
npm run type-check
```

### 调试技巧

#### Go服务调试
```bash
# 使用Delve调试器
go install github.com/go-delve/delve/cmd/dlv@latest
dlv debug ./cmd/main.go
```

#### React调试
- 使用浏览器开发者工具
- 安装React Developer Tools扩展
- 使用Redux DevTools扩展

---

## 📚 学习资源

### 文档链接
- [Gin框架文档](https://gin-gonic.com/)
- [GORM文档](https://gorm.io/)
- [React官方文档](https://react.dev/)
- [TypeScript文档](https://www.typescriptlang.org/)

### 最佳实践
- [Go代码规范](https://github.com/golang/go/wiki/CodeReviewComments)
- [React最佳实践](https://react.dev/learn/thinking-in-react)
- [TypeScript最佳实践](https://typescript-eslint.io/rules/)

---

## 🤝 贡献指南

### 开发流程
1. Fork项目
2. 创建功能分支
3. 提交代码
4. 创建Pull Request

### 代码规范
- Go代码使用`gofmt`格式化
- JavaScript/TypeScript使用Prettier格式化
- 提交信息遵循Conventional Commits规范

### 提交规范
```
feat: 新功能
fix: 修复bug
docs: 文档更新
style: 代码格式调整
refactor: 代码重构
test: 测试相关
chore: 构建或工具相关
```

---

*最后更新：2024年12月*  
*维护团队：开发团队*
