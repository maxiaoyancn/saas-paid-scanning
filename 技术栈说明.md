# æ”¶è´¹è½¯ä»¶æ£€æµ‹ç³»ç»Ÿ - æŠ€æœ¯æ ˆè¯´æ˜
## Tech Stack Documentation

---

## ğŸ”§ æŠ€æœ¯æ ˆæ¦‚è§ˆ

### åç«¯æŠ€æœ¯æ ˆ (Golang)
```
è¯­è¨€ï¼šGolang 1.21+
Webæ¡†æ¶ï¼šGin (é«˜æ€§èƒ½HTTPæ¡†æ¶)
ORMï¼šGORM (Goè¯­è¨€ORMåº“)
æ•°æ®åº“ï¼šPostgreSQL + Redis
ä»»åŠ¡é˜Ÿåˆ—ï¼šAsynq (åŸºäºRedisçš„åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—)
æ¶ˆæ¯é˜Ÿåˆ—ï¼šRabbitMQ (amqp091-go)
```

### å‰ç«¯æŠ€æœ¯æ ˆ (React)
```
è¯­è¨€ï¼šTypeScript
æ¡†æ¶ï¼šReact 18+
çŠ¶æ€ç®¡ç†ï¼šRedux Toolkit / Zustand
UIç»„ä»¶åº“ï¼šAnt Design / Material-UI
æ„å»ºå·¥å…·ï¼šVite / Create React App
å›¾è¡¨åº“ï¼šChart.js / Recharts
```

### æ¡Œé¢å®¢æˆ·ç«¯
```
æ¡†æ¶ï¼šElectron + React
è¯­è¨€ï¼šTypeScript
æ‰“åŒ…ï¼šelectron-builder
æ›´æ–°ï¼šelectron-updater
```

---

## ğŸ“¦ æ ¸å¿ƒä¾èµ–åŒ…

### Golangåç«¯ä¾èµ–

#### Webæ¡†æ¶å’Œä¸­é—´ä»¶
```go
// go.mod
module saas-scanning-system

go 1.21

require (
    github.com/gin-gonic/gin v1.9.1
    github.com/gin-contrib/cors v1.4.0
    github.com/gin-contrib/pprof v1.4.0
    github.com/gin-contrib/requestid v0.0.6
)
```

#### æ•°æ®åº“å’Œç¼“å­˜
```go
require (
    gorm.io/gorm v1.25.5
    gorm.io/driver/postgres v1.5.4
    github.com/go-redis/redis/v8 v8.11.5
    github.com/golang-migrate/migrate/v4 v4.16.2
)
```

#### è®¤è¯å’Œå®‰å…¨
```go
require (
    github.com/golang-jwt/jwt/v4 v4.5.0
    golang.org/x/crypto v0.14.0
    github.com/casbin/casbin/v2 v2.77.2
)
```

#### ä»»åŠ¡é˜Ÿåˆ—å’Œæ¶ˆæ¯
```go
require (
    github.com/hibiken/asynq v0.24.1
    github.com/streadway/amqp v1.1.0
    github.com/gorilla/websocket v1.5.0
)
```

#### ç›‘æ§å’Œæ—¥å¿—
```go
require (
    github.com/sirupsen/logrus v1.9.3
    github.com/prometheus/client_golang v1.17.0
    go.opentelemetry.io/otel v1.19.0
    go.opentelemetry.io/otel/exporters/jaeger v1.17.0
)
```

#### å·¥å…·åº“
```go
require (
    github.com/spf13/viper v1.17.0  // é…ç½®ç®¡ç†
    github.com/google/uuid v1.3.1   // UUIDç”Ÿæˆ
    github.com/robfig/cron/v3 v3.0.1 // å®šæ—¶ä»»åŠ¡
    gonum.org/v1/gonum v0.14.0      // æ•°å­¦è®¡ç®—
)
```

### Reactå‰ç«¯ä¾èµ–

#### package.json
```json
{
  "name": "saas-scanning-frontend",
  "version": "1.0.0",
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "typescript": "^5.0.0",
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0"
  }
}
```

#### çŠ¶æ€ç®¡ç†å’Œè·¯ç”±
```json
{
  "dependencies": {
    "@reduxjs/toolkit": "^1.9.7",
    "react-redux": "^8.1.3",
    "react-router-dom": "^6.17.0",
    "zustand": "^4.4.4"
  }
}
```

#### UIç»„ä»¶å’Œæ ·å¼
```json
{
  "dependencies": {
    "antd": "^5.11.0",
    "@ant-design/icons": "^5.2.6",
    "styled-components": "^6.1.0",
    "tailwindcss": "^3.3.5"
  }
}
```

#### å›¾è¡¨å’Œå¯è§†åŒ–
```json
{
  "dependencies": {
    "chart.js": "^4.4.0",
    "react-chartjs-2": "^5.2.0",
    "recharts": "^2.8.0",
    "d3": "^7.8.5"
  }
}
```

#### HTTPå®¢æˆ·ç«¯å’Œå·¥å…·
```json
{
  "dependencies": {
    "axios": "^1.6.0",
    "react-query": "^3.39.3",
    "dayjs": "^1.11.10",
    "lodash": "^4.17.21"
  }
}
```

---

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

### åç«¯é¡¹ç›®ç»“æ„ (Golang)
```
saas-scanning-backend/
â”œâ”€â”€ cmd/
â”‚   â”œâ”€â”€ auth/           # è®¤è¯æœåŠ¡
â”‚   â”œâ”€â”€ scanner/        # æ‰«ææœåŠ¡
â”‚   â”œâ”€â”€ risk/           # é£é™©è¯„ä¼°æœåŠ¡
â”‚   â”œâ”€â”€ analytics/      # æ•°æ®åˆ†ææœåŠ¡
â”‚   â””â”€â”€ notification/   # é€šçŸ¥æœåŠ¡
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ auth/           # è®¤è¯æ¨¡å—
â”‚   â”œâ”€â”€ scanner/        # æ‰«ææ¨¡å—
â”‚   â”œâ”€â”€ risk/           # é£é™©è¯„ä¼°æ¨¡å—
â”‚   â”œâ”€â”€ analytics/      # åˆ†ææ¨¡å—
â”‚   â”œâ”€â”€ notification/   # é€šçŸ¥æ¨¡å—
â”‚   â”œâ”€â”€ common/         # å…¬å…±æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ config/     # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ database/   # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ cache/      # ç¼“å­˜ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ middleware/ # ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ utils/      # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ models/         # æ•°æ®æ¨¡å‹
â”œâ”€â”€ pkg/                # å…¬å…±åŒ…
â”‚   â”œâ”€â”€ logger/         # æ—¥å¿—åŒ…
â”‚   â”œâ”€â”€ validator/      # éªŒè¯åŒ…
â”‚   â””â”€â”€ errors/         # é”™è¯¯å¤„ç†
â”œâ”€â”€ api/                # APIå®šä¹‰
â”‚   â””â”€â”€ openapi/        # OpenAPIè§„èŒƒ
â”œâ”€â”€ configs/            # é…ç½®æ–‡ä»¶
â”œâ”€â”€ scripts/            # è„šæœ¬æ–‡ä»¶
â”œâ”€â”€ deployments/        # éƒ¨ç½²æ–‡ä»¶
â”‚   â”œâ”€â”€ docker/         # Dockeræ–‡ä»¶
â”‚   â””â”€â”€ k8s/            # Kubernetesé…ç½®
â”œâ”€â”€ docs/               # æ–‡æ¡£
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â””â”€â”€ Makefile
```

### å‰ç«¯é¡¹ç›®ç»“æ„ (React)
```
saas-scanning-frontend/
â”œâ”€â”€ public/             # é™æ€èµ„æº
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/     # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ common/     # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ charts/     # å›¾è¡¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ forms/      # è¡¨å•ç»„ä»¶
â”‚   â”œâ”€â”€ pages/          # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ dashboard/  # ä»ªè¡¨æ¿
â”‚   â”‚   â”œâ”€â”€ scan/       # æ‰«æé¡µé¢
â”‚   â”‚   â”œâ”€â”€ reports/    # æŠ¥å‘Šé¡µé¢
â”‚   â”‚   â””â”€â”€ settings/   # è®¾ç½®é¡µé¢
â”‚   â”œâ”€â”€ hooks/          # è‡ªå®šä¹‰Hooks
â”‚   â”œâ”€â”€ services/       # APIæœåŠ¡
â”‚   â”œâ”€â”€ store/          # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ slices/     # Reduxåˆ‡ç‰‡
â”‚   â”‚   â””â”€â”€ index.ts    # Storeé…ç½®
â”‚   â”œâ”€â”€ utils/          # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ types/          # TypeScriptç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ styles/         # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ assets/         # é™æ€èµ„æº
â”‚   â”œâ”€â”€ App.tsx
â”‚   â”œâ”€â”€ index.tsx
â”‚   â””â”€â”€ vite-env.d.ts
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â””â”€â”€ tailwind.config.js
```

---

## ğŸ”Œ æœåŠ¡é—´é€šä¿¡

### HTTP REST API
```go
// APIè·¯ç”±å®šä¹‰
func SetupRoutes(r *gin.Engine) {
    api := r.Group("/api/v1")
    
    // è®¤è¯ç›¸å…³
    auth := api.Group("/auth")
    {
        auth.POST("/login", handleLogin)
        auth.POST("/register", handleRegister)
        auth.POST("/refresh", handleRefreshToken)
    }
    
    // æ‰«æç›¸å…³
    scan := api.Group("/scan")
    scan.Use(authMiddleware.RequireAuth())
    {
        scan.POST("/start", handleStartScan)
        scan.GET("/results/:id", handleGetScanResults)
        scan.GET("/history", handleGetScanHistory)
    }
    
    // é£é™©è¯„ä¼°
    risk := api.Group("/risk")
    risk.Use(authMiddleware.RequireAuth())
    {
        risk.GET("/assessment/:software_id", handleGetRiskAssessment)
        risk.POST("/bulk-assess", handleBulkAssessment)
    }
}
```

### gRPCæœåŠ¡é—´è°ƒç”¨
```go
// risk_service.proto
syntax = "proto3";

package risk;

service RiskAssessmentService {
    rpc AssessRisk(AssessRiskRequest) returns (AssessRiskResponse);
    rpc BulkAssess(BulkAssessRequest) returns (BulkAssessResponse);
}

message AssessRiskRequest {
    string software_id = 1;
    SoftwareInfo software_info = 2;
}

message AssessRiskResponse {
    int32 risk_score = 1;
    string risk_level = 2;
    repeated string reasons = 3;
}
```

### WebSocketå®æ—¶é€šä¿¡
```go
// WebSocketå¤„ç†å™¨
func handleWebSocket(c *gin.Context) {
    conn, err := upgrader.Upgrade(c.Writer, c.Request, nil)
    if err != nil {
        log.Printf("WebSocket upgrade failed: %v", err)
        return
    }
    defer conn.Close()
    
    client := &Client{
        conn: conn,
        send: make(chan []byte, 256),
    }
    
    hub.register <- client
    
    go client.writePump()
    go client.readPump()
}
```

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### GORMæ¨¡å‹å®šä¹‰
```go
// ç”¨æˆ·æ¨¡å‹
type User struct {
    ID               uint      `gorm:"primarykey" json:"id"`
    Username         string    `gorm:"uniqueIndex;not null" json:"username"`
    Email            string    `gorm:"uniqueIndex;not null" json:"email"`
    PasswordHash     string    `gorm:"not null" json:"-"`
    Role             string    `gorm:"default:user" json:"role"`
    SubscriptionType string    `gorm:"default:free" json:"subscription_type"`
    CreatedAt        time.Time `json:"created_at"`
    UpdatedAt        time.Time `json:"updated_at"`
    
    // å…³è”
    Devices     []Device     `gorm:"foreignKey:UserID" json:"devices,omitempty"`
    ScanResults []ScanResult `gorm:"foreignKey:UserID" json:"scan_results,omitempty"`
}

// è½¯ä»¶ä¿¡æ¯æ¨¡å‹
type Software struct {
    ID                     uint      `gorm:"primarykey" json:"id"`
    Name                   string    `gorm:"not null" json:"name"`
    Vendor                 string    `json:"vendor"`
    Version                string    `json:"version"`
    LicenseType            string    `json:"license_type"`
    CommercialUseAllowed   bool      `json:"commercial_use_allowed"`
    IndividualUseFree      bool      `json:"individual_use_free"`
    RiskLevel              int       `gorm:"check:risk_level >= 0 AND risk_level <= 100" json:"risk_level"`
    LastPolicyChange       *time.Time `json:"last_policy_change"`
    DataCollection         bool      `gorm:"default:false" json:"data_collection"`
    NetworkActivityLevel   int       `gorm:"default:0" json:"network_activity_level"`
    FingerprintHash        string    `gorm:"index" json:"fingerprint_hash"`
    CreatedAt              time.Time `json:"created_at"`
    UpdatedAt              time.Time `json:"updated_at"`
    
    // å…³è”
    ScanResults []ScanResult `gorm:"foreignKey:SoftwareID" json:"scan_results,omitempty"`
}

// æ‰«æç»“æœæ¨¡å‹
type ScanResult struct {
    ID              uint      `gorm:"primarykey" json:"id"`
    UserID          uint      `gorm:"not null" json:"user_id"`
    DeviceID        uint      `gorm:"not null" json:"device_id"`
    SoftwareID      uint      `gorm:"not null" json:"software_id"`
    DetectedVersion string    `json:"detected_version"`
    InstallationPath string   `json:"installation_path"`
    FileSize        int64     `json:"file_size"`
    InstallDate     *time.Time `json:"install_date"`
    LastUsed        *time.Time `json:"last_used"`
    UsageFrequency  int       `gorm:"default:0" json:"usage_frequency"`
    RiskScore       int       `json:"risk_score"`
    ScanDate        time.Time `gorm:"default:CURRENT_TIMESTAMP" json:"scan_date"`
    Status          string    `gorm:"default:active" json:"status"` // active, removed, updated, ignored
    
    // å…³è”
    User     User     `gorm:"foreignKey:UserID" json:"user,omitempty"`
    Device   Device   `gorm:"foreignKey:DeviceID" json:"device,omitempty"`
    Software Software `gorm:"foreignKey:SoftwareID" json:"software,omitempty"`
}
```

---

## ğŸš€ éƒ¨ç½²å’Œè¿ç»´

### Docker Composeå¼€å‘ç¯å¢ƒ
```yaml
# docker-compose.dev.yml
version: '3.8'

services:
  # æ•°æ®åº“
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: saas_scanning
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
  
  # Redisç¼“å­˜
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    command: redis-server --appendonly yes
    volumes:
      - redis_data:/data
  
  # RabbitMQæ¶ˆæ¯é˜Ÿåˆ—
  rabbitmq:
    image: rabbitmq:3-management-alpine
    ports:
      - "5672:5672"
      - "15672:15672"
    environment:
      RABBITMQ_DEFAULT_USER: admin
      RABBITMQ_DEFAULT_PASS: password
    volumes:
      - rabbitmq_data:/var/lib/rabbitmq
  
  # è®¤è¯æœåŠ¡
  auth-service:
    build:
      context: ./services/auth
      dockerfile: Dockerfile.dev
    ports:
      - "8081:8080"
    environment:
      - DATABASE_URL=postgres://postgres:password@postgres:5432/saas_scanning?sslmode=disable
      - REDIS_URL=redis://redis:6379
    depends_on:
      - postgres
      - redis
    volumes:
      - ./services/auth:/app
      - /app/tmp
  
  # æ‰«ææœåŠ¡
  scanner-service:
    build:
      context: ./services/scanner
      dockerfile: Dockerfile.dev
    ports:
      - "8082:8080"
    environment:
      - DATABASE_URL=postgres://postgres:password@postgres:5432/saas_scanning?sslmode=disable
      - REDIS_URL=redis://redis:6379
      - RABBITMQ_URL=amqp://admin:password@rabbitmq:5672/
    depends_on:
      - postgres
      - redis
      - rabbitmq
    volumes:
      - ./services/scanner:/app
      - /app/tmp

volumes:
  postgres_data:
  redis_data:
  rabbitmq_data:
```

### Makefileå‘½ä»¤
```makefile
# Makefile
.PHONY: help build test run clean docker-build docker-up docker-down

# é»˜è®¤ç›®æ ‡
help:
	@echo "å¯ç”¨å‘½ä»¤:"
	@echo "  build        - ç¼–è¯‘æ‰€æœ‰æœåŠ¡"
	@echo "  test         - è¿è¡Œæµ‹è¯•"
	@echo "  run          - è¿è¡Œå¼€å‘ç¯å¢ƒ"
	@echo "  clean        - æ¸…ç†æ„å»ºæ–‡ä»¶"
	@echo "  docker-build - æ„å»ºDockeré•œåƒ"
	@echo "  docker-up    - å¯åŠ¨å¼€å‘ç¯å¢ƒ"
	@echo "  docker-down  - åœæ­¢å¼€å‘ç¯å¢ƒ"

# ç¼–è¯‘æ‰€æœ‰æœåŠ¡
build:
	@echo "ç¼–è¯‘è®¤è¯æœåŠ¡..."
	cd services/auth && go build -o ../../bin/auth-service ./cmd/main.go
	@echo "ç¼–è¯‘æ‰«ææœåŠ¡..."
	cd services/scanner && go build -o ../../bin/scanner-service ./cmd/main.go
	@echo "ç¼–è¯‘é£é™©è¯„ä¼°æœåŠ¡..."
	cd services/risk && go build -o ../../bin/risk-service ./cmd/main.go

# è¿è¡Œæµ‹è¯•
test:
	@echo "è¿è¡Œæµ‹è¯•..."
	cd services/auth && go test -v ./...
	cd services/scanner && go test -v ./...
	cd services/risk && go test -v ./...

# è¿è¡Œå¼€å‘ç¯å¢ƒ
run:
	docker-compose -f docker-compose.dev.yml up --build

# æ¸…ç†æ„å»ºæ–‡ä»¶
clean:
	rm -rf bin/
	rm -rf tmp/
	go clean -cache

# æ„å»ºDockeré•œåƒ
docker-build:
	docker build -t saas-scanning/auth-service:latest ./services/auth
	docker build -t saas-scanning/scanner-service:latest ./services/scanner
	docker build -t saas-scanning/risk-service:latest ./services/risk

# å¯åŠ¨å¼€å‘ç¯å¢ƒ
docker-up:
	docker-compose -f docker-compose.dev.yml up -d

# åœæ­¢å¼€å‘ç¯å¢ƒ
docker-down:
	docker-compose -f docker-compose.dev.yml down
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–
```go
// æ•°æ®åº“è¿æ¥æ± é…ç½®
func setupDatabase() *gorm.DB {
    dsn := os.Getenv("DATABASE_URL")
    
    db, err := gorm.Open(postgres.Open(dsn), &gorm.Config{
        Logger: logger.Default.LogMode(logger.Info),
        NamingStrategy: schema.NamingStrategy{
            SingularTable: true,
        },
    })
    if err != nil {
        log.Fatal("Failed to connect to database:", err)
    }
    
    sqlDB, err := db.DB()
    if err != nil {
        log.Fatal("Failed to get database instance:", err)
    }
    
    // è¿æ¥æ± é…ç½®
    sqlDB.SetMaxIdleConns(10)
    sqlDB.SetMaxOpenConns(100)
    sqlDB.SetConnMaxLifetime(time.Hour)
    
    return db
}
```

### Redisç¼“å­˜ä¼˜åŒ–
```go
// Redisè¿æ¥é…ç½®
func setupRedis() *redis.Client {
    rdb := redis.NewClient(&redis.Options{
        Addr:         os.Getenv("REDIS_URL"),
        Password:     "",
        DB:           0,
        PoolSize:     10,
        PoolTimeout:  30 * time.Second,
        IdleTimeout:  5 * time.Minute,
        ReadTimeout:  3 * time.Second,
        WriteTimeout: 3 * time.Second,
    })
    
    // æµ‹è¯•è¿æ¥
    ctx := context.Background()
    _, err := rdb.Ping(ctx).Result()
    if err != nil {
        log.Fatal("Failed to connect to Redis:", err)
    }
    
    return rdb
}
```

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0*  
*åˆ›å»ºæ—¶é—´ï¼š2024å¹´12æœˆ*  
*ç»´æŠ¤å›¢é˜Ÿï¼šæŠ€æœ¯å›¢é˜Ÿ*
